/*! @name videojs-contrib-quality-menu @version 1.0.3 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsContribQualityMenu=t(e.videojs)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=t(e);const l=s.default.getComponent("MenuItem"),i=s.default.dom||s.default;class a extends l{constructor(e,t={}){const s=t.selected;t.selected=t.active,super(e,t);const l=e.qualityLevels();this.levels_=t.levels,this.selected_=s,this.handleQualityChange=this.handleQualityChange.bind(this),this.controlText(t.controlText),this.on(l,"change",this.handleQualityChange),this.on("dispose",(()=>{this.off(l,"change",this.handleQualityChange)}))}createEl(e,t,s){const l=super.createEl(e,t,s),a=i.createEl("span",{className:"vjs-quality-menu-item-sub-label",innerHTML:this.localize(this.options_.subLabel||"")});return this.subLabel_=a,l&&l.appendChild(a),l}handleClick(){this.updateSiblings_();const e=this.player().qualityLevels(),t=e.selectedIndex;for(let s=0,l=e.length;s<l;s++)s!==t&&(e[s].enabled=!1);for(let t=0,s=this.levels_.length;t<s;t++)e[this.levels_[t]].enabled=!0;-1!==t&&-1===this.levels_.indexOf(t)&&(e[t].enabled=!1)}handleQualityChange(){const e=this.player().qualityLevels(),t=this.levels_.indexOf(e.selectedIndex)>-1;this.selected(t)}selected(e){if(this.selectable)if(this.selected_){this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(this.localize("{1}, selected",this.localize(this.options_.controlText)));const t=this.player().controlBar.getChild("QualityMenuButton");e?t.removeClass("vjs-quality-menu-button-waiting"):t.addClass("vjs-quality-menu-button-waiting")}else this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(this.options_.controlText)}updateSiblings_(){const e=this.player().qualityLevels(),t=this.player().controlBar.getChild("QualityMenuButton").items;for(let s=0,l=t.length;s<l;s++){const l=t[s],i=l.levels_.indexOf(e.selectedIndex)>-1;l.selected_=l===this,l.selected(i)}}}const n=s.default.getComponent("MenuButton"),o=function(e){return Array.from(e).some((e=>e.height))},u=function(e){return e>=2160?"4K":e>=720?"HD":""};s.default.registerComponent("QualityMenuButton",class extends n{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-label",this.localize("Quality Levels")),this.controlText("Quality Levels"),e.options().experimentalSvgIcons||this.$(".vjs-icon-placeholder").classList.add("vjs-icon-cog"),this.setIcon("cog"),this.qualityLevels_=e.qualityLevels(),this.update=this.update.bind(this),this.hide=this.hide.bind(this),this.handleQualityChange_=this.handleQualityChange_.bind(this),this.firstChangeHandler_=this.firstChangeHandler_.bind(this),this.enableDefaultResolution_=this.enableDefaultResolution_.bind(this),this.on(this.qualityLevels_,"addqualitylevel",this.update),this.on(this.qualityLevels_,"removequalitylevel",this.update),this.on(this.qualityLevels_,"change",this.handleQualityChange_),this.one(this.qualityLevels_,"change",this.firstChangeHandler_),e.on("adstart",this.hide),e.on(["adend","adtimeout"],this.update),this.update(),this.on("dispose",(()=>{this.off(this.qualityLevels_,"addqualitylevel",this.update),this.off(this.qualityLevels_,"removequalitylevel",this.update),this.off(this.qualityLevels_,"change",this.handleQualityChange_),this.off(this.qualityLevels_,"change",this.firstChangeHandler_),e.off("adstart",this.hide),e.off(["adend","adtimeout"],this.update),e.off("loadedmetadata",this.enableDefaultResolution_)}))}buildWrapperCSSClass(){return`vjs-quality-menu-wrapper ${super.buildWrapperCSSClass()}`}buildCSSClass(){return`vjs-quality-menu-button ${super.buildCSSClass()}`}createItems(){const e=[];if(!this.qualityLevels_||!this.qualityLevels_.length)return e;let t;if(this.options_.useResolutionLabels&&o(this.qualityLevels_)?(t=this.groupByResolution_(),this.addClass("vjs-quality-menu-button-use-resolution")):(t=this.groupByBitrate_(),this.removeClass("vjs-quality-menu-button-use-resolution")),t.length<=1)return[];t.forEach((t=>{t.levels.length&&(t.selectable=!0,e.push(new a(this.player(),t)))}));const s=new a(this.player(),{levels:Array.prototype.map.call(this.qualityLevels_,((e,t)=>t)),label:"Auto",controlText:"Auto",active:!0,selected:!0,selectable:!0});return this.autoMenuItem_=s,e.push(s),e}groupByResolution_(){const e={},t=[];for(let s=0,l=this.qualityLevels_.length;s<l;s++){const l=this.qualityLevels_[s],i=this.qualityLevels_.selectedIndex===s,a=l.height;if(!a)continue;let n;if(this.options_.resolutionLabelBitrates){n=`${a}p @ ${Math.round(l.bitrate/1e3)} kbps`}else n=a+"p";if(!e[n]){const s=u(a);e[n]={levels:[],label:n,controlText:n,subLabel:s},t.push({label:n,lines:a})}i&&(e[n].active=!0),e[n].levels.push(s)}t.sort(((e,t)=>t.lines-e.lines));const s=[];return t.forEach((t=>{s.push(e[t.label])})),s}groupByBitrate_(){const e=[{levels:[],label:"HD",controlText:"High Definition"},{levels:[],label:"SD",controlText:"Standard Definition"}];for(let t=0,s=this.qualityLevels_.length;t<s;t++){const s=this.qualityLevels_[t],l=this.qualityLevels_.selectedIndex===t;let i;i=s.bitrate<this.options_.sdBitrateLimit?e[1]:e[0],l&&(i.active=!0),i.levels.push(t)}return e[0].levels.length&&e[1].levels.length?e:[]}handleQualityChange_(){const e=this.qualityLevels_[this.qualityLevels_.selectedIndex],t=this.options_.useResolutionLabels&&o(this.qualityLevels_);let s="";e&&(t?s=u(e.height):e.bitrate>=this.options_.sdBitrateLimit&&(s="HD")),"HD"===s?(this.addClass("vjs-quality-menu-button-HD-flag"),this.removeClass("vjs-quality-menu-button-4K-flag")):"4K"===s?(this.removeClass("vjs-quality-menu-button-HD-flag"),this.addClass("vjs-quality-menu-button-4K-flag")):(this.removeClass("vjs-quality-menu-button-HD-flag"),this.removeClass("vjs-quality-menu-button-4K-flag")),this.autoMenuItem_&&(this.autoMenuItem_.manuallySelected_&&e?this.autoMenuItem_.subLabel_.innerHTML=this.localize(s):this.autoMenuItem_.subLabel_.innerHTML="")}enableDefaultResolution_(){const e=this.options_.defaultResolution;for(let t=0;t<this.items.length;t++)-1!==this.items[t].options_.label.indexOf(e)&&this.items[t].handleClick()}firstChangeHandler_(){this.player_.readyState()<1&&"none"!==this.player_.preload()?this.player_.one("loadedmetadata",this.enableDefaultResolution_):this.enableDefaultResolution_()}});var h="1.0.3";const d={sdBitrateLimit:2e6,useResolutionLabels:!0,resolutionLabelBitrates:!1,defaultResolution:"none"},r=(e,t)=>{e.addClass("vjs-quality-menu");const s=e.getChild("controlBar"),l=s.addChild("QualityMenuButton",t,s.children_.length-2);return function(){e.removeClass("vjs-quality-menu"),s.removeChild(l),l.dispose()}},c=function(e){!function(e,t){if(void 0!==e.qualityLevels){e.qualityLevels();let s=()=>{};e.ready((()=>{s=r(e,t),e.on("loadstart",(()=>{s(),s=r(e,t)}))})),e.qualityMenu=()=>{},e.qualityMenu.VERSION=h}}(this,s.default.obj.merge(d,e))};return s.default.registerPlugin("qualityMenu",c),c.VERSION=h,c}));
